
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />
<style>
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        box-sizing: border-box;
        display: inline-block;
        min-width: 1.5em;
        padding: 0.5em 1em;
        margin-left: 2px;
        text-align: center;
        text-decoration: none !important;
        cursor: pointer;
        *cursor: hand;
        /*        color: #333 !important;*/
        /*      border: 1px solid transparent;*/
        /*     border-radius: 2px;*/

        color: #697a8d;
        background-color: #f0f2f4;
        border: 0px solid #d9dee3;
        transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            border-color: #696cff;
            background-color: #696cff;
            color: #fff !important;
            border: 1px solid #696cff;
            background-color: white;
            /*            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #fff), color-stop(100%, #dcdcdc));
            background: -webkit-linear-gradient(top, #fff 0%, #dcdcdc 100%);
            background: -moz-linear-gradient(top, #fff 0%, #dcdcdc 100%);
            background: -ms-linear-gradient(top, #fff 0%, #dcdcdc 100%);
            background: -o-linear-gradient(top, #fff 0%, #dcdcdc 100%);*/
            background: linear-gradient(to bottom, #696cff 0%, #696cff 100%);
            box-shadow: 0 0.125rem 0.25rem rgba(105, 108, 255, 0.4);
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            color: #697a8d !important;
            border: 0px solid #fff;
            background-color: #585858;
            /* background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #585858), color-stop(100%, #111)); */
            /* background: -webkit-linear-gradient(top, #585858 0%, #111 100%); */
            background: -moz-linear-gradient(top, #585858 0%, #111 100%);
            background: -ms-linear-gradient(top, #585858 0%, #111 100%);
            background: -o-linear-gradient(top, #585858 0%, #111 100%);
            background: linear-gradient(to bottom, #e9eaeb 0%, #eaeaeb 100%);
            border-color: rgba(67, 89, 113, 0.3);
        }

    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #d9dee3;
        border-radius: 5px;
        padding: 5px;
        background-color: transparent;
        margin-left: 3px;
        color: #697a8d;
    }

</style>
<!-- Toast with Placements -->
<div class="bs-toast toast toast-placement-ex m-2" role="alert" aria-live="assertive" aria-atomic="true" data-delay="5000">
    <div class="toast-header">
        <i class="bx bx-bell me-2"></i>
        <div class="me-auto fw-semibold" id="AlertaTitulo"></div>
        <small id="AlertaFecha"></small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body" id="AlertaTexto"></div>
</div>


<div class="card mb-4">
    <h5 class="card-header">Reporte de actividad, por unidad de negocio.  </h5>
    <!-- Basic Pagination -->
    <div class="card-body">
        <div class="row">
            <div class="col">
                <small class="text-light fw-semibold">Completa los campos marcados *</small>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4">
                <div class="mb-3">
                    <label class="form-label" for="basic-icon-default-fullname"> Fecha inicio  </label>
                    <div class="input-group input-group-merge">
                        <span id="basic-icon-default-fullname2" class="input-group-text">
                            <i class="bx bx-calendar"></i>
                        </span>
                        <input type="date" class="form-control" id="FechaInicio" placeholder="Nombre" aria-label="" aria-describedby="Contacto_FechaNacimiento" onchange="ValidaInput('FechaInicio')" />
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="mb-3">
                    <label class="form-label" for="basic-icon-default-fullname"> Fecha termino  </label>
                    <div class="input-group input-group-merge">
                        <span id="basic-icon-default-fullname2" class="input-group-text">
                            <i class="bx bx-calendar"></i>
                        </span>
                        <input type="date" class="form-control" id="FechaTermino" placeholder="Nombre" aria-label="" aria-describedby="Contacto_FechaNacimiento" onchange="ValidaInput('FechaTermino')" />
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="mb-3">
                    <label class="form-label" for="basic-icon-default-fullname">* Unidad de negocio </label>
                    <div class="input-group">
                        <select id='UnidadNegocio' class="form-select" aria-label="UnidadNegocio" onchange="ValidaSelect('UnidadNegocio')">
                            <option value="0" selected>SELECCIONAR</option>
                            @foreach (var item in ViewBag.UnidadNegocio)
                            {
                                <option value="@item.Id">@item.Nombre.ToUpper()</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="demo-inline-spacing">
                    <button type="button" class="btn btn-primary" style="width: 100%;" onclick="BtnConsultar()">
                        <span class="tf-icons bx bx-save"></span>&nbsp; Consultar
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>


<div class="card mb-4" id="DivActividades" style="display:none">
    <h5 class="card-header">Actividades registradas </h5>
    <!-- Basic Pagination -->
    <div class="card-body">
        <div class="row">
            <div class="col">
                <small class="text-light fw-semibold">Lista de actividades registradas en llamadas, correos, mensajes, notas, reuniones y tareas. Filtrado por unidad de negocio.</small>
            </div>
        </div>
        <div class="row" id="TableActividades">

        </div>
    </div>
</div>

<div class="card mb-4" id="DivContactos" style="display:none">
    <h5 class="card-header">Contactos registrados </h5>
    <!-- Basic Pagination -->
    <div class="card-body">
        <div class="row">
            <div class="col">
                <small class="text-light fw-semibold">Nuevos contactos. Filtrado por unidad de negocio.</small>
            </div>
        </div>
        <div class="row" id="TableContactos">

        </div>
    </div>
</div>

<div class="card mb-4" id="DivOportunidades" style="display:none">
    <h5 class="card-header">Oportunidades registradas </h5>
    <!-- Basic Pagination -->
    <div class="card-body">
        <div class="row">
            <div class="col">
                <small class="text-light fw-semibold">Nuevas oportunidades. Filtrado por unidad de negocio.</small>
            </div>
        </div>
        <div class="row">
            <h5 class="card-header">
                MONTO TOTAL: <strong><span id="totalSuma"> $ 0.00</span></strong>
            </h5>
        </div>
        <div class="row" id="TableOportunidades">

        </div>
    </div>
</div>

<div class="card mb-4" id="DivEmpresas" style="display:none">
    <h5 class="card-header">Empresas registradas </h5>
    <!-- Basic Pagination -->
    <div class="card-body">
        <div class="row">
            <div class="col">
                <small class="text-light fw-semibold">Nuevas empresas. Filtrado por unidad de negocio.</small>
            </div>
        </div>
        <div class="row" id="TableEmpresas">

        </div>
    </div>
</div>

<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

<script>
    function BtnConsultar() {
        if (ValidForm()) {
            var Resultado = 0;
            $("#DivActividades").css("display", "none");
            $("#DivContactos").css("display", "none");
            $("#DivOportunidades").css("display", "none");
            $("#DivEmpresas").css("display", "none");

            var CatUnidadNegocio = new Object();
            CatUnidadNegocio.Id = $("#UnidadNegocio option:selected").val();

            var Actividades = new Object();
            Actividades.CatUnidadNegocio = CatUnidadNegocio;
            Actividades.FechaInicio = $('#FechaInicio').val();
            Actividades.FechaTermino = $('#FechaTermino').val();

            $.ajax({
                type: "POST",
                url: "@Url.Action("Actividades_Selecionar_FechaRegistro", "Actividades")",
                async: false,
                data: JSON.stringify(Actividades),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    Resultado += 1;
                    $("#DivActividades").show();


                    var Table = "<div class='col-lg-12'>" +
                                    "<div class='table-responsive text-nowrap'>" +
                                        "<table class='table table-hover table-striped' id='TableListaActividades'>" +
                                            "<thead>" +
                                                "<tr class='text-center'>" +
                                                    "<th>Entidad </th>" +
                                                    "<th>Actividad </th>" +
                                                    "<th>Especificación  </th>" +
                                                    "<th>Descripción </th>" +
                                                    "<th>Fecha registro </th>" +
                                                "</tr>" +
                                            "</thead>" +
                                            "<tfoot>" +
                                                "<tr class='text-center'>" +
                                                    "<th>Entidad </th>" +
                                                    "<th>Actividad </th>" +
                                                    "<th>Especificación  </th>" +
                                                    "<th>Descripción </th>" +
                                                    "<th>Fecha registro </th>" +
                                                "</tr>" +
                                            "</tfoot>" +
                                            "<tbody class='table-border-bottom-0'>";
                                for (var b = 0; b < data.length; b++) {
                                    var Actividad = 0;
                                    if (data[b].Actividad == "Llamada") {
                                        Actividad = 1;
                                    } else if (data[b].Actividad == "Mensaje") {
                                        Actividad = 2;
                                    } else if (data[b].Actividad == "Nota") {
                                        Actividad = 3;
                                    } else if (data[b].Actividad == "Correo") {
                                        Actividad = 4;
                                    } else if (data[b].Actividad == "Reunión") {
                                        Actividad = 5;
                                    } else if (data[b].Actividad == "Tarea") {
                                        Actividad = 6;
                                    }


                                    Table += "<tr class='text-center' >" +
                                        "<td onclick='MostrarActividad(" + data[b].Id + "," + data[b].IdEntidad + ", " + Actividad +")'><i class='fab fa-angular fa-lg text-danger me-3'></i> <strong style='cursor: pointer;'>" + data[b].Entidad + "</strong></td>" +
                                                "<td><i class='fab fa-angular fa-lg text-danger me-3'></i> <strong>" + data[b].Actividad + "</strong></td>" +
                                                "<td><i class='fab fa-angular fa-lg text-danger me-3'></i> " + data[b].Titulo + "</td>" +
                                                "<td><i class='fab fa-angular fa-lg text-danger me-3'></i> " + data[b].Descripcion + "</td>" +
                                                "<td><i class='fab fa-angular fa-lg text-danger me-3'></i> " + data[b].FechaRegistro + "</td>" +
                                            "</tr>";
                                }

                                Table += "</tbody>" +
                                    "</table>" +
                                "</div>" +
                        "</div>";

                    $("#TableActividades").html(Table);

                    $('#TableListaActividades').DataTable({

                        columnDefs: [
                            {
                                targets: [4], visible: true, searchable: false, orderable: true,
                                render: function (value) {
                                    if (value === null) return "";
                                    var pattern = /Date\(([^)]+)\)/; //date format from server side
                                    var results = pattern.exec(value);
                                    var dt = new Date(parseFloat(results[1]));
                                    if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
                                    return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
                                    /*return ('0' + dt.getDate()).slice(-2) + "/" + ('0' + (dt.getMonth() + 1)).slice(-2) + "/" + dt.getFullYear();*/
                                }
                            },
                        ],
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
                        },
                        "pageLength": 10,
                    });

                },
                error: function () {
                    $("#DivActividades").css("display", "none");
                }
            });

            $.ajax({
                type: "POST",
                url: "@Url.Action("Contacto_Seleccionar_FechaRegistro", "Contacto")",
                async: false,
                data: JSON.stringify(Actividades),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Resultado += 1;
                    $("#DivContactos").show();


                    var Table = "<div class='col-lg-12'>" +
                        "<div class='table-responsive text-nowrap'>" +
                        "<table class='table table-hover table-striped' id='TableListaContactos'>" +
                        "<thead>" +
                            "<tr>" +
                                "<th>Nombre  </th>" +
                                "<th>Email  </th>" +
                                "<th>Teléfono   </th>" +
                                "<th>Celular    </th>" +
                                "<th>Cargo </th>" +
                                "<th>Empresa </th>" +
                                "<th>Unidad de negocio </th>" +
                                "<th>Tipo contacto </th>" +
                                "<th>Fecha creación </th>" +
                             /*   "<th>Fecha última actividad</th>" +*/
                                "<th>Estatus</th>" +
                            "</tr>" +
                        "</thead>" +
                        "<tfoot>" +
                            "<tr>" +
                                "<th>Nombre  </th>" +
                                "<th>Email  </th>" +
                                "<th>Teléfono   </th>" +
                                "<th>Celular    </th>" +
                                "<th>Cargo </th>" +
                                "<th>Empresa </th>" +
                                "<th>Unidad de negocio </th>" +
                                "<th>Tipo contacto </th>" +
                                "<th>Fecha creación </th>" +
                /*                "<th>Fecha última actividad</th>" +*/
                                "<th>Estatus</th>" +
                            "</tr>" +
                        "</tfoot>" +
                        "<tbody class='table-border-bottom-0'>";
                    for (var b = 0; b < data.length; b++) {
                        var ApellidoPaterno = "";
                        if (data[b].Contacto.Persona.ApellidoPaterno != null) {
                            ApellidoPaterno = data[b].Contacto.Persona.ApellidoPaterno;
                        }
                        var ApellidoMaterno = "";
                        if (data[b].Contacto.Persona.ApellidoMaterno != null) {
                            ApellidoMaterno = data[b].Contacto.Persona.ApellidoMaterno;
                        }

                        var Telefono = "";
                        if (data[b].Telefono != null) {
                            Telefono = data[b].Telefono;
                        }

                        var Celular = "";
                        if (data[b].Celular != null) {
                            Celular = data[b].Celular;
                        }
                        var Empresa = "";
                        if (data[b].Empresa != null) {
                            Empresa = data[b].Empresa;
                        }

                        Table += "<tr class='text-center'>" +
                                "<td onclick='MostrarContacto(" + data[b].Contacto.Persona.Id + ")'> <strong style='cursor: pointer;'>" + data[b].Contacto.Persona.Nombre + " " + ApellidoPaterno + " " + ApellidoMaterno  + "</strong></td>" +
                                "<td>" + data[b].Contacto.Persona.Email.email + "</td> " +
                                "<td>" + Telefono + "</td>" +
                                "<td>" + Celular + "</td> " +
                                "<td>" + data[b].Contacto.CatCargo.Nombre + "</td>" +
                                "<td>" + Empresa + "</td>" +
                                "<td>" + data[b].Contacto.Persona.CatUnidadNegocio.Nombre + "</td>" +
                                "<td>" + data[b].Contacto.Persona.CatTipoPersona.Nombre + "</td>" +
                                "<td>" + data[b].Contacto.FechaRegistro + "</td>" +
                           /*     "<td>-</td>" +*/
                                "<td><span class='badge bg-label-"+ data[b].Contacto.Persona.CatEstatusPersona.Color +" me-1'>" + data[b].Contacto.Persona.CatEstatusPersona.Nombre + "</span></td>" +
                            "</tr>";
                    }

                    Table += "</tbody>" +
                        "</table>" +
                        "</div>" +
                        "</div>";

                    $("#TableContactos").html(Table);

                    $('#TableListaContactos').DataTable({

                        columnDefs: [
                            {
                                targets: [8], visible: true, searchable: false, orderable: true,
                                render: function (value) {
                                    if (value === null) return "";
                                    var pattern = /Date\(([^)]+)\)/; //date format from server side
                                    var results = pattern.exec(value);
                                    var dt = new Date(parseFloat(results[1]));
                                    if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
                                    return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
                                }
                            },
                        ],
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
                        },
                        "pageLength": 10,
                    });
                },
                error: function () {

                }
            });

            $.ajax({
                type: "POST",
                url: "@Url.Action("Oportunidad_Seleccionar_FechaRegistro", "Oportunidad")",
                async: false,
                data: JSON.stringify(Actividades),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Resultado += 1;
                    /*console.log(data);*/
                    $("#DivOportunidades").show();


                    var Table = "<div class='col-lg-12'>" +
                        "<div class='table-responsive text-nowrap'>" +
                        "<table class='table table-hover table-striped' id='TableListaOportunidades'>" +
                            "<thead>" +
                                "<tr>" +
                                    "<th>Oportunidad </th>" +
                                    "<th>Importe </th>" +
                                    "<th>Empresa </th>" +
                                    "<th>Unidad de negocio </th>" +
                                    "<th>Tipo </th>" +
                                    "<th>Prioridad </th>" +
                                    "<th>Fecha creación </th>" +
                                    "<th>Fecha cierre </th>" +
                                    "<th>Estatus</th>" +
                                    "<th>Progreso</th>" +
                                "</tr>" +
                            "</thead>" +
                            "<tfoot>" +
                                "<tr>" +
                                    "<th>Oportunidad </th>" +
                                    "<th>Importe </th>" +
                                    "<th>Empresa </th>" +
                                    "<th>Unidad de negocio </th>" +
                                    "<th>Tipo </th>" +
                                    "<th>Prioridad </th>" +
                                    "<th>Fecha creación </th>" +
                                    "<th>Fecha cierre </th>" +
                                    "<th>Estatus</th>" +
                                    "<th>Progreso</th>" +
                                "</tr>" +
                            "</tfoot>" +
                        "<tbody class='table-border-bottom-0'>";
                    for (var b = 0; b < data.length; b++) {
                        var Importe = "$0.00";
                        if (data[b].Importe != null) {
                            Importe = data[b].Importe;
                        }
                        var Empresa = "";
                        if (data[b].Empresa != null) {
                            Empresa = data[b].Empresa;
                        }
                        var Progreso = "0";
                        if (data[b].Empresa != null) {
                            Progreso = data[b].Progreso;
                        }

                        Table += "<tr class='text-center'>" +
                                    "<td onclick='MostrarOportunidad(" + data[b].Id + ")'> <strong style='cursor: pointer;'>" + data[b].Nombre +"</strong></td>" +
                                    "<td class='valor' style='text-align:right'>" + Importe + "</td> " +
                                    "<td>" + Empresa + "</td>" +
                                    "<td>" + data[b].CatUnidadNegocio.Nombre + "</td> " +
                                    "<td>" + data[b].CatTipoOportunidad.Nombre + "</td>" +
                                    "<td>" + data[b].CatPrioridad.Nombre + "</td>" +
                                    "<td>" + data[b].FechaCierre + "</td>" +
                                    "<td>" + data[b].FechaCierre + "</td>" +
                                    "<td><span class='badge bg-label-primary me-1'>" + data[b].CatEstatusOpurtunidad.Nombre + "</span></td>" +
                                    "<td><span class='badge bg-label-primary me-1'>" + Progreso +" %</span></td>" +
                                "</tr>";
                    }

                    Table += "</tbody>" +
                        "</table>" +
                        "</div>" +
                        "</div>";

                    $("#TableOportunidades").html(Table);

                    var tabla =  $('#TableListaOportunidades').DataTable({
                                    columnDefs: [
                                        {
                                            targets: [6], visible: true, searchable: false, orderable: true,
                                            render: function (value) {
                                                if (value === null) return "";
                                                var pattern = /Date\(([^)]+)\)/; //date format from server side
                                                var results = pattern.exec(value);
                                                var dt = new Date(parseFloat(results[1]));
                                                if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
                                                return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
                                            }
                                        },
                                        {
                                            targets: [7], visible: true, searchable: false, orderable: true,
                                            render: function (value) {
                                                if (value === null) return "";
                                                var pattern = /Date\(([^)]+)\)/; //date format from server side
                                                var results = pattern.exec(value);
                                                var dt = new Date(parseFloat(results[1]));
                                                if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
                                                return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
                                            }
                                        },
                                    ],
                                    "language": {
                                        "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
                                    },
                                    "pageLength": 10,
                                });

                    var total = 0;

                    function calcularSuma() {
                        total = 0;
                        tabla.rows({ search: 'applied' }).nodes().to$().find('.valor').each(function () {
                            var valorTexto = $(this).text().replace('$', '').replace(/,/g, '');
                            total += parseFloat(valorTexto);
                        });
                        if (formatProdPrice(total.toFixed(2)) == '$NaN') {
                            $('#totalSuma').text('$ 0.00');
                        } else {
                            $('#totalSuma').text('' + formatProdPrice(total.toFixed(2)));
                        }
                    }

                    tabla.on('draw.dt', calcularSuma);

                    calcularSuma(); // Calcular la suma inicial al cargar la página


                    $('#TableListaOportunidades_filter input').on('keyup', function () {
                        calcularSuma();
                    })

                },
                error: function () {

                }
            });

            $.ajax({
                type: "POST",
                url: "@Url.Action("Empresa_Seleccionar_FechaRegistro", "Empresa")",
                async: false,
                data: JSON.stringify(Actividades),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Resultado += 1;
                    $("#DivEmpresas").show();


                    var Table = "<div class='col-lg-12'>" +
                        "<div class='table-responsive text-nowrap'>" +
                        "<table class='table table-hover table-striped' id='TableListaEmpresas'>" +
                        "<thead>" +
                            "<tr>" +
                                "<th>Nombre de la empresa </th>" +
                                "<th>Unidad de negocio </th>" +
                                "<th>Tipo empresa </th>" +
                                "<th>Industria</th>" +
                                "<th>Fecha creación </th>" +
                                /*"<th>Fecha última actividad</th>" +*/
                                "<th>Estatus</th>" +
                            "</tr>" +
                        "</thead>" +
                        "<tfoot>" +
                            "<tr>" +
                                "<th>Nombre de la empresa </th>" +
                                "<th>Unidad de negocio </th>" +
                                "<th>Tipo empresa </th>" +
                                "<th>Industria</th>" +
                                "<th>Fecha creación </th>" +
                        /*        "<th>Fecha última actividad</th>" +*/
                                "<th>Estatus</th>" +
                            "</tr>" +
                        "</tfoot>" +
                        "<tbody class='table-border-bottom-0'>";
                    for (var b = 0; b < data.length; b++) {

                        Table += "<tr class='text-center'>" +
                                    "<td onclick='MostrarEmpresa(" + data[b].Id + ")'> <strong style='cursor: pointer;'>" + data[b].Nombre + "</strong></td>" +
                                    "<td>" + data[b].CatUnidadNegocio.Nombre + "</td> " +
                                    "<td>" + data[b].CatTipoEmpresa.Nombre + "</td>" +
                                    "<td>" + data[b].CatIndustria.Nombre + "</td> " +
                                    "<td>" + data[b].FechaRegistro + "</td>" +
                                    /*"<td>-</td>" +*/
                                    "<td>-</td>" +
                                "</tr>";
                    }

                    Table += "</tbody>" +
                        "</table>" +
                        "</div>" +
                        "</div>";

                    $("#TableEmpresas").html(Table);

                    $('#TableListaEmpresas').DataTable({

                        columnDefs: [
                            {
                                targets: [4], visible: true, searchable: false, orderable: true,
                                render: function (value) {
                                    if (value === null) return "";
                                    var pattern = /Date\(([^)]+)\)/; //date format from server side
                                    var results = pattern.exec(value);
                                    var dt = new Date(parseFloat(results[1]));
                                    if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
                                    return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
                                }
                            },
                        ],
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
                        },
                        "pageLength": 10,
                    });

                },
                error: function () {

                }
            });

            if (Resultado == 0) {
                AlertWarning('Resultados no encontrados','No se encontraros registros en ese rango de fechas.')
            }
        } else {
            AlertIncompleto();
        }
    }

    function ValidForm() {
        var result = false;
        $('#FechaInicio').css("border", "1px solid #f44336");
        $('#FechaInicio').css("border-left", "none");
        $('#FechaTermino').css("border", "1px solid #f44336");
        $('#FechaTermino').css("border-left", "none");
        $('#UnidadNegocio').css("border", "1px solid #f44336");

        if ($('#FechaInicio').val().length > 0) {
            $('#FechaInicio').css("border", "1px solid #d9dee3");
            $('#FechaInicio').css("border-left", "none");
        }

        if ($('#FechaTermino').val().length > 0) {
            $('#FechaTermino').css("border", "1px solid #d9dee3");
            $('#FechaTermino').css("border-left", "none");
        }

        if ($("#UnidadNegocio option:selected").val() > 0) {
            $('#UnidadNegocio').css("border", "1px solid #d9dee3");
        }

        if ($('#FechaInicio').val().length > 0) {
            if ($('#FechaTermino').val().length > 0) {
                if ($("#UnidadNegocio option:selected").val() > 0) {
                    result = true;
                }
            }
        }

        return result;
    }

    function MostrarActividad(IdValor, IdEntidad, Actividad) {

        var Actividades = new Object();
        Actividades.Id = IdValor;
        Actividades.IdEntidad = IdEntidad;
        Actividades.Actividad = Actividad;

        $.ajax({
            type: "POST",
            url: "@Url.Action("Actividades_Selecionar_Valor", "Actividades")",
            async: false,
            data: JSON.stringify(Actividades),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                if (IdEntidad == 1) {
                    MostrarContacto(data.Id);
                } else if (IdEntidad == 2) {
                    MostrarEmpresa(data.Id);
                } else if (IdEntidad == 3) {
                    MostrarOportunidad(data.Id);
                }
            },
            error: function () {

            }
        });
    }

    function MostrarContacto(num) {
        var obj = {};

        obj['UrlVaible'] = num;

        var jsonObject = {
            "URL": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("URL_Cifrar", "URLS")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                window.location.href = '@Url.Action("Contacto", "Contacto")?cont=' + result.Url;
            },
            error: function () {
                AlertDanger("Problemas al consultar ", "Intentolo mas tarde.");
            }
        });
    }

    function MostrarEmpresa(num) {
        var obj = {};

        obj['UrlVaible'] = num;

        var jsonObject = {
            "URL": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("URL_Cifrar", "URLS")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                window.location.href = '@Url.Action("Empresa", "Empresa")?cont=' + result.Url;
            },
            error: function () {
                AlertDanger("Problemas al consultar ", "Intentolo mas tarde.");
            }
        });

    }

    function MostrarOportunidad(num) {
        var obj = {};

        obj['UrlVaible'] = num;

        var jsonObject = {
            "URL": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("URL_Cifrar", "URLS")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (result) {
                window.location.href = '@Url.Action("Oportunidad", "Oportunidad")?cont=' + result.Url;
            },
            error: function () {
                AlertDanger("Problemas al consultar ", "Intentolo mas tarde.");
            }
        });
    }
</script>

<script>
    const toastPlacementExample = document.querySelector('.toast-placement-ex');
    let selectedType, selectedPlacement, toastPlacement;

    function toastDispose(toast) {
        if (toast && toast._element !== null) {
            if (toastPlacementExample) {
                toastPlacementExample.classList.remove(selectedType);
                DOMTokenList.prototype.remove.apply(toastPlacementExample.classList, selectedPlacement);
            }
            toast.dispose();
        }
    }

    function AlertIncompleto() {

        if (toastPlacement) {
            toastDispose(toastPlacement);
        }

        selectedType = 'bg-primary';
        selectedPlacement = ['top-0', 'end-0'];

        toastPlacementExample.classList.add(selectedType);
        DOMTokenList.prototype.add.apply(toastPlacementExample.classList, selectedPlacement);
        toastPlacement = new bootstrap.Toast(toastPlacementExample);
        toastPlacement.show();

        var fecha = new Date();
        var hora = fecha.toLocaleTimeString();
        $("#AlertaFecha").text(hora);
        $("#AlertaTitulo").text("Formulario incompleto");
        $("#AlertaTexto").text("Completa la información del formulario.");
    }

    function AlertWarning(titulo, texto) {

        if (toastPlacement) {
            toastDispose(toastPlacement);
        }

        selectedType = 'bg-warning';
        selectedPlacement = ['top-0', 'end-0'];
        toastPlacementExample.classList.add(selectedType);
        DOMTokenList.prototype.add.apply(toastPlacementExample.classList, selectedPlacement);
        toastPlacement = new bootstrap.Toast(toastPlacementExample);
        toastPlacement.show();

        var fecha = new Date();
        var hora = fecha.toLocaleTimeString();
        $("#AlertaFecha").text(hora);
        $("#AlertaTitulo").text(titulo);
        $("#AlertaTexto").text(texto);
    }

    function AlertDanger(titulo, texto) {

        if (toastPlacement) {
            toastDispose(toastPlacement);
        }

        selectedType = 'bg-danger';
        selectedPlacement = ['bottom-0', 'end-0'];
        toastPlacementExample.classList.add(selectedType);
        DOMTokenList.prototype.add.apply(toastPlacementExample.classList, selectedPlacement);
        toastPlacement = new bootstrap.Toast(toastPlacementExample);
        toastPlacement.show();

        var fecha = new Date();
        var hora = fecha.toLocaleTimeString();
        $("#AlertaFecha").text(hora);
        $("#AlertaTitulo").text(titulo);
        $("#AlertaTexto").text(texto);
    }

    function AlertDanger(titulo, texto) {

        if (toastPlacement) {
            toastDispose(toastPlacement);
        }

        selectedType = 'bg-danger';
        selectedPlacement = ['bottom-0', 'end-0'];
        toastPlacementExample.classList.add(selectedType);
        DOMTokenList.prototype.add.apply(toastPlacementExample.classList, selectedPlacement);
        toastPlacement = new bootstrap.Toast(toastPlacementExample);
        toastPlacement.show();

        var fecha = new Date();
        var hora = fecha.toLocaleTimeString();
        $("#AlertaFecha").text(hora);
        $("#AlertaTitulo").text(titulo);
        $("#AlertaTexto").text(texto);
    }

    function AlertSuccess(titulo, texto) {

        if (toastPlacement) {
            toastDispose(toastPlacement);
        }

        selectedType = 'bg-success';
        selectedPlacement = ['top-0', 'end-0'];
        toastPlacementExample.classList.add(selectedType);
        DOMTokenList.prototype.add.apply(toastPlacementExample.classList, selectedPlacement);
        toastPlacement = new bootstrap.Toast(toastPlacementExample);
        toastPlacement.show();

        var fecha = new Date();
        var hora = fecha.toLocaleTimeString();
        $("#AlertaFecha").text(hora);
        $("#AlertaTitulo").text(titulo);
        $("#AlertaTexto").text(texto);
    }

    function formatProdPrice(value) {
        return new Intl.NumberFormat("en-US", { style: "currency", currency: "USD" }).format(value);
    }
</script>
<script>

    function ValidaInput(name) {
        if ($('#' + name).val().length > 0) {
            $('#' + name).css("border", "1px solid #d9dee3");
            $('#' + name).css("border-left", "none");
        } else {
            $('#' + name).css("border", "1px solid #f44336");
        }
    }

    function ValidaSelect(name) {
        if ($('#' + name + ' option:selected').val() > 0) {
            $('#select2-' + name + '-container').css("border", "0px solid #d9dee3");
            $('#' + name).css("border", "1px solid #d9dee3");
        } else {
            $('#' + name).css("border", "1px solid #f44336");
            $('#select2-' + name + '-container').css("border", "1px solid #f44336");
        }
    }

    $('#Nv1Reportes').addClass("active open");
    $('#Nv1ReportesLista').addClass("active");
</script>

